<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/static/image/logo.jpeg">
    <title>Profil</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/lucide-icons@0.1.0/dist/lucide.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .profil-container {
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 80%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            background: #fff;
        }

        .profil-header {
            display: flex;
            flex-direction: row;
            align-items: center;
            margin-bottom: 30px;
        }

        .profil-header h2 {
            color: #333;
            font-size: 2.2em;
            margin-bottom: 10px;
            text-align: left;
        }

        .profil-info {
            text-align: left;
            margin-bottom: 30px;
        }

        .profil-info p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 8px;
            font-size: 1em;
            display: flex;
            align-items: center;
        }

        .profil-info i {
            margin-right: 8px;
            color: #4F959D;
            font-size: 1.2em;
        }

        .profil-info strong {
            font-weight: bold;
            color: #143D60;
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .profil-container {
                padding: 20px;
                width: 95%;
            }

            .profil-header {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
            }

            .profil-info p {
                flex-wrap: wrap;
                justify-content: flex-start;
            }

            .profil-info i {
                margin-right: 4px;
            }
        }

        .edit-button {
            display: inline-block;
            margin-top: 40px;
            padding: 12px 25px;
            background-color: #4F959D;
            color: white;
            text-decoration: none;
            filter: drop-shadow(0,0,10px,#4F959D);
            border-radius: 8px;
            font-weight: bold;
            transition: background-color 0.3s ease, color 0.3s ease; /* Transition pour la couleur du texte et le fond */
            border: #4F959D 1px solid;
        }

        .edit-button:hover {
            background-color: white; /* Couleur de fond au survol */
    color: #4F959D; /* Couleur de texte au survol */
    transition: 1s ease-in-out;
    border: #4F959D 1px solid;
    
        }

        .hidden {
            display: none;
        }

        .mt-6 {
            margin-top: 1.5rem; /* Equivalent de Tailwind CSS */
        }

        .p-6 {
            padding: 1.5rem; /* Equivalent de Tailwind CSS */
        }

        .bg-blue-50 {
            background-color: #eff6ff; /* Equivalent de Tailwind CSS */
        }

        .rounded-xl {
            border-radius: 0.75rem; /* Equivalent de Tailwind CSS */
        }

        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Equivalent de Tailwind CSS */
        }

        .border {
            border-width: 1px; /* Equivalent de Tailwind CSS */
        }

        .border-blue-200 {
            border-color: #93c5fd; /* Equivalent de Tailwind CSS */
        }

        .text-xl {
            font-size: 1.25rem; /* Equivalent de Tailwind CSS */
        }

        .font-semibold {
            font-weight: 600; /* Equivalent de Tailwind CSS */
        }

        .text-blue-800 {
            color: #2563eb; /* Equivalent de Tailwind CSS */
        }

        .mb-4 {
            margin-bottom: 1rem; /* Equivalent de Tailwind CSS */
        }

        .flex {
            display: flex; /* Equivalent de Tailwind CSS */
        }

        .items-center {
            align-items: center; /* Equivalent de Tailwind CSS */
        }

        .gap-2 {
            gap: 0.5rem; /* Equivalent de Tailwind CSS */
        }

        .grid {
            display: grid; /* Equivalent de Tailwind CSS */
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr)); /* Equivalent de Tailwind CSS */
        }

        .sm\:grid-cols-2 {
            @media (min-width: 640px) {
                grid-template-columns: repeat(2, minmax(0, 1fr)); /* Equivalent de Tailwind CSS */
            }
        }

        .block {
            display: block; /* Equivalent de Tailwind CSS */
        }

        .text-gray-700 {
            color: #4b5563; /* Equivalent de Tailwind CSS */
        }

        .text-sm {
            font-size: 0.875rem; /* Equivalent de Tailwind CSS */
        }

        .font-bold {
            font-weight: 700; /* Equivalent de Tailwind CSS */
        }

        .mb-2 {
            margin-bottom: 0.5rem; /* Equivalent de Tailwind CSS */
        }

        .shadow-inner {
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); /* Equivalent de Tailwind CSS */
        }

        .leading-tight {
            line-height: 1.25; /* Equivalent de Tailwind CSS */
        }

        .focus\:outline-none:focus {
            outline: 2px solid transparent;
            outline-offset: 2px; /* Equivalent de Tailwind CSS */
        }

        .focus\:shadow-outline:focus {
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5); /* Equivalent de Tailwind CSS */
        }

        .bg-green-500 {
            background-color: #48bb78; /* Equivalent de Tailwind CSS */
        }

        .text-white {
            color: #fff; /* Equivalent de Tailwind CSS */
        }

        .hover\:bg-green-700:hover {
            background-color: #2f855a; /* Equivalent de Tailwind CSS */
        }

        .transition-all {
            transition-property: all; /* Equivalent de Tailwind CSS */
        }

        .duration-200 {
            transition-duration: 0.2s; /* Equivalent de Tailwind CSS */
        }

        .bg-gray-300 {
            background-color: #e2e8f0; /* Equivalent de Tailwind CSS */
        }

        .text-gray-700 {
            color: #4a5568; /* Equivalent de Tailwind CSS */
        }

        .hover\:bg-gray-400:hover {
            background-color: #cbd5e0; /* Equivalent de Tailwind CSS */
        }
    </style>
</head>

<body>
    <div class="profil-container">
        <div class="profil-header">
            <div class="profil-info">
                <p><i class='bx bx-id-card'></i><strong>ID:</strong> {{ user['id'] }}</p>
                <p><i class='bx bx-user'></i><strong>Username:</strong> {{ user['username'] }}</p>
                <p><i class='bx bx-user-circle'></i><strong>Prénom:</strong> {{ user['prenom'] }}</p>
                <p><i class='bx bx-envelope'></i><strong>Email:</strong> {{ user['email'] }}</p>
                <p><i class='bx bx-briefcase'></i><strong>Poste:</strong> {{ user['poste'] }}</p>
                <p><i class='bx bx-phone'></i><strong>Téléphone:</strong> {{ user['telephone'] }}</p>
                <p><i class='bx bx-lock'></i><strong>Role:</strong> {{ user['role'] }}</p>
            </div>
           
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button onclick="toggleEditForm()" class="edit-button" id="edit-button">
                <i class='bx bx-edit'></i> Modifier Profil
            </button>
        </div>

        <form id="edit-profile-form" class="hidden mt-6 p-6 bg-blue-50 rounded-xl shadow-lg border border-blue-200">
            <h2 class="text-xl font-semibold text-blue-800 mb-4 flex items-center gap-2">
                <i data-lucide="pencil"></i> Modifier Votre Profil
            </h2>
            <input type="hidden" id="edit-id" name="id" value="{{ user['id'] }}">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="edit-username" class="block text-gray-700 text-sm font-bold mb-2">Nom d'utilisateur:</label>
                    <input type="text" id="edit-username" name="username" value="{{ user['username'] }}" required
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div>
                    <label for="edit-prenom" class="block text-gray-700 text-sm font-bold mb-2">Prénom:</label>
                    <input type="text" id="edit-prenom" name="prenom" value="{{ user['prenom'] }}" required
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div>
                    <label for="edit-email" class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                    <input type="email" id="edit-email" name="email" value="{{ user['email'] }}" required
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div>
                    <label for="edit-poste" class="block text-gray-700 text-sm font-bold mb-2">Poste:</label>
                    <input type="text" id="edit-poste" name="poste" value="{{ user['poste'] }}"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div>
                    <label for="edit-telephone" class="block text-gray-700 text-sm font-bold mb-2">Téléphone:</label>
                    <input type="number" id="edit-telephone" name="telephone" value="{{ user['telephone'] }}"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div>
                    <label for="edit-password" class="block text-gray-700 text-sm font-bold mb-2">Nouveau Mot de passe :</label>
                    <input type="password" id="edit-password" name="password"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div>
                    <label for="edit-role" class="block text-gray-700 text-sm font-bold mb-2">Role:</label>
                    <select name="role" id="edit-role" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="chef admin" {% if user['role'] == 'chef admin' %}selected{% endif %}>chef admin</option>
                        <option value="admin" {% if user['role'] == 'admin' %}selected{% endif %}>admin</option>
                    </select>
                </div>
            </div>
            <div class="mt-4 flex gap-2">
                <button type="submit"class="mt-5 px-4 py-2 bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200 transition-all duration-200 flex items-center gap-1">
                    <i data-lucide="save"></i> Enregistrer les modifications
                </button>
                <button type="button" onclick="toggleEditForm()" class="mt-5 px-4 py-2 bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200 transition-all duration-200 flex items-center gap-1">
                    <i data-lucide="x"></i> Annuler
                </button>
            </div>
        </form>

       
    </div>

    <script>
        function toggleEditForm() {
            const profileInfo = document.querySelector('.profil-info');
            const editForm = document.getElementById('edit-profile-form');
            const editbtn = document.getElementById('edit-button');
            profileInfo.classList.toggle('hidden');
            editForm.classList.toggle('hidden');
            editbtn.classList.toggle('hidden');


        }

        document.getElementById('edit-profile-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('edit-id').value;
            const username = document.getElementById('edit-username').value;
            const prenom = document.getElementById('edit-prenom').value;
            const email = document.getElementById('edit-email').value;
            const poste = document.getElementById('edit-poste').value;
            const telephone = document.getElementById('edit-telephone').value;
            const password = document.getElementById('edit-password').value; // Peut être vide
            const role = document.getElementById('edit-role').value;

            const formData = {
                username: username,
                prenom: prenom,
                email: email,
                poste: poste,
                telephone: telephone,
                role: role
            };

          
            if (password) {
                formData.password = password;
            }

            try {
                const response = await fetch(`/api/users/${id}`, { 
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    alert('Profil mis à jour avec succès!');
                    window.location.reload(); 
                } else {
                    const errorData = await response.json();
                    alert(`Erreur lors de la mise à jour du profil: ${errorData.error || response.statusText}`);
                    console.error('Erreur lors de la mise à jour du profil:', errorData);
                }
            } catch (error) {
                alert('Erreur réseau lors de la mise à jour du profil.');
                
                    console.error('Erreur réseau:', error);
                }
            });

        lucide.createIcons(); 
    </script>
    <div id="menu"></div>

    <script>
       
        const API_URL = '/api/users'; 

        async function editUser(id) {
            try {
                const res = await fetch(`${API_URL}/${id}`);
                if (!res.ok) throw new Error("Erreur HTTP " + res.status);
                const user = await res.json();

               
                const form = document.getElementById("edit-profile-form"); 
                if (form) {
                    form.classList.remove("hidden");
                    document.querySelector('.profil-info').classList.add('hidden'); 
                    document.getElementById("edit-id").value = user.id;
                    document.getElementById("edit-username").value = user.username;
                    document.getElementById("edit-prenom").value = user.prenom;
                    document.getElementById("edit-email").value = user.email;
                    document.getElementById("edit-poste").value = user.poste;
                    document.getElementById("edit-telephone").value = user.telephone;
                    document.getElementById("edit-role").value = user.role;
                    document.getElementById("edit-password").value = ''; 

                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    console.warn("Formulaire d'édition introuvable !");
                }
            } catch (error) {
                console.error(error);
            }
        }

        function cancelEdit() {
            const form = document.getElementById("edit-profile-form");  
            if (form) {
                form.classList.add("hidden");
                document.querySelector('.profil-info').classList.remove('hidden');
            }
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuDiv = document.getElementById("menu");

            fetch("/static/menu.html")
                .then(response => response.text())
                .then(data => {
                    if (menuDiv) {
                        menuDiv.innerHTML = data;
                        attachEventListenersToNav('.desktop-nav');
                        attachEventListenersToNav('.mobile-nav');
                        checkAndApplyActiveStateOnLoad();
                    }
                })
                .catch(error => console.error('Erreur lors du chargement du menu :', error));

            function attachEventListenersToNav(navSelector) {
                const nav = document.querySelector(navSelector);
                if (nav) {
                    const navItems = nav.querySelectorAll('.nav-item, .mobile-nav-item');
                    navItems.forEach(item => {
                        item.addEventListener('click', function() {
                            activateNavItem(this, navSelector);
                        });
                    });
                }
            }

            function activateNavItem(item, navSelector) {
                const activeItem = document.querySelector(`${navSelector} .nav-item.active, ${navSelector} .mobile-nav-item.active`);
                if (activeItem && activeItem !== item) {
                    activeItem.classList.remove('active');
                }
                item.classList.add('active');
                localStorage.setItem('activeNavLink', item.dataset.navlink);
            }

            function checkAndApplyActiveStateOnLoad() {
                const storedActiveNavLink = localStorage.getItem('activeNavLink');
                const desktopNavItems = document.querySelectorAll('.desktop-nav .nav-item');
                const mobileNavItems = document.querySelectorAll('.mobile-nav .mobile-nav-item');
                const currentPage = window.location.pathname;
                const allNavItems = [...desktopNavItems, ...mobileNavItems];

                if (storedActiveNavLink) {
                    allNavItems.forEach(item => {
                        if (item.dataset.navlink === storedActiveNavLink) {
                            item.classList.add('active');
                        }
                    });
                } else {
                    if (currentPage === '/' || currentPage === '/dashboard') {
                        allNavItems.forEach(item => {
                            if (item.dataset.navlink === 'accueil') {
                                item.classList.add('active');
                                localStorage.setItem('activeNavLink', 'accueil');
                            }
                        });
                    } else {
                        allNavItems.forEach(item => {
                            if (item.getAttribute('href') === currentPage) {
                                item.classList.add('active');
                                localStorage.setItem('activeNavLink', item.dataset.navlink);
                            }
                        });
                    }
                }
            }
        });
    </script>
</body>
</html>